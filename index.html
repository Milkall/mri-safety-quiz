<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Trial & MRI Safety Quiz</title>
    <style>
        /* CSS æ¨£å¼ (ç¶­æŒä¸è®Š) */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f4f7f6;
        }

        #game-container {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
        }

        h1 {
            color: #004d40;
            text-align: center;
        }
        
        .question-box {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #b2dfdb;
            border-radius: 8px;
            background-color: #e0f2f1;
        }

        .option-button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 6px;
            background-color: #00897b;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }

        .option-button:hover {
            background-color: #00695c;
        }
        
        .option-button:active {
            transform: scale(0.98);
        }

        /* ç­”æ¡ˆåé¥‹èˆ‡åœ–ç‰‡å®¹å™¨ */
        #feedback {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            border-radius: 8px;
            min-height: 40px; 
        }

        #mri-stage {
            background-color: #fff8e1;
            border: 1px solid #ffecb3;
            width: 100%; 
            height: 200px;
            position: relative; 
        }

        /* MRI æ¨¡æ“¬ SVG æ¨£å¼ */
        #mri-scene {
            width: 100%;
            height: 100%;
        }

        /* ç—…äººåœ–ç¤ºçš„ç§»å‹•æ§åˆ¶ */
        #patient-bed-group {
            /* é€™æ˜¯åŒ…å«ç—…äººã€åºŠå¢Šã€åºŠæ¶çš„å¯ç§»å‹•ç¾¤çµ„ */
            transition: transform 1.5s ease-in-out; 
            transform-origin: center;
        }

        /* å°ˆé–€ç”¨æ–¼ç­”éŒ¯é¡ŒäºŒçš„å‹•ç•«æ•ˆæœ (æ–æ™ƒ) */
        .shake-animation {
            animation: shake 0.5s;
        }
        
        /* æ–æ™ƒå‹•ç•«ï¼šä½¿ç”¨ transform: translateX */
        @keyframes shake {
            0%, 100% { transform: translateX(50px); } 
            20%, 60% { transform: translateX(45px); }
            40%, 80% { transform: translateX(55px); }
        }

        /* é¡è‰²å›é¥‹ */
        .correct { background-color: #e8f5e9; color: #2e7d32; border-color: #a5d6a7; }
        .incorrect { background-color: #ffebee; color: #c62828; border-color: #ef9a9a; }
        .info { background-color: #e3f2fd; color: #1565c0; border-color: #90caf9; }
        .disabled { opacity: 0.5; pointer-events: none; } 
    </style>
</head>
<body>

    <div id="game-container">
        <h1>ğŸ¥ Clinical Trial & MRI Safety Game ğŸ§ </h1>
        
        <div id="mri-stage">
            <svg viewBox="0 0 700 200" id="mri-scene">
                
                <rect x="350" y="20" width="300" height="160" rx="20" fill="#fcf7e6" stroke="#1b4965" stroke-width="2"/>
                <circle cx="500" cy="100" r="60" fill="white" stroke="#1b4965" stroke-width="2"/>
                <text x="450" y="15" font-size="12" fill="#1b4965">MRI SCANNER</text>
                
                <g id="patient-bed-group" transform="translate(50, 0)"> 
                    
                    <rect x="20" y="170" width="160" height="5" fill="#F4A261" stroke="#1b4965" stroke-width="1"/>
                    
                    <rect x="0" y="145" width="200" height="20" fill="#F4A261" stroke="#1b4965" stroke-width="2"/>
                    
                    <rect x="5" y="135" width="190" height="10" fill="#B3D9FF" stroke="#1b4965" stroke-width="1"/>
                    
                    <line x1="40" y1="170" x2="40" y2="155" stroke="#F4A261" stroke-width="10"/>
                    <line x1="160" y1="170" x2="160" y2="155" stroke="#F4A261" stroke-width="10"/>

                    <g id="patient">
                        <rect x="45" y="113" width="100" height="15" rx="5" fill="#1b4965"/>
                        
                        <circle cx="160" cy="120.5" r="15" fill="#1b4965"/> 
                        
                        <rect x="35" y="120.5" width="10" height="7.5" rx="3" fill="#1b4965"/> 
                        
                        </g>
                </g>
            </svg>
        </div>

        <div id="feedback" class="info">Please select an answer.</div>

        <div id="question-area">
            </div>
    </div>

    <script>
        const questionArea = document.getElementById('question-area');
        const feedbackDiv = document.getElementById('feedback');
        // æ“ä½œçš„æ˜¯åŒ…å«ç—…åºŠå’Œç—…äººçš„æ•´å€‹ SVG ç¾¤çµ„
        const patientElement = document.getElementById('patient-bed-group'); 
        let currentQuestionIndex = 0;
        let isAnswerLocked = false;
        
        // --- è¨­å®šç—…äººç§»å‹•çš„ç›®æ¨™ä½ç½® (X è»¸åç§»é‡) ---
        const STAGE_POSITIONS = {
            'stage-1': 50,       // åˆå§‹ä½ç½® 
            'stage-2': 180,      // é€²å…¥ MRI ä¸€åŠ 
            'stage-3': 290       // å®Œæ•´é€²å…¥ MRI 
        };

        /**
         * è¨­ç½® SVG ç¾¤çµ„çš„ transform å±¬æ€§ä¾†æ§åˆ¶ç§»å‹•
         * @param {number} xPos - x è»¸çš„ç§»å‹•ä½ç½® 
         */
        function setPatientPosition(xPos, yPos = 0) { 
            patientElement.setAttribute('transform', `translate(${xPos}, ${yPos})`);
            patientElement.classList.remove('shake-animation');
        }

        const questions = [
            {
                text: "Question 1: According to regulatory guidelines (FDA/EMA), what is the single most critical document in a clinical trial that must be finalized before \"Data Lock\" to ensure scientific integrity and prevent post-hoc bias?",
                options: [
                    "The Final Clinical Study Report (CSR)",
                    "The Statistical Analysis Plan (SAP)",
                    "The Subject Informed Consent Form"
                ],
                answerIndex: 1, 
                correctAction: () => {
                    setPatientPosition(STAGE_POSITIONS['stage-2']); 
                },
                incorrectAction: () => {
                    feedbackDiv.className = 'incorrect';
                    // ä¿®æ­£é» 1: ä½¿ç”¨ <strong> ä»£æ›¿ **
                    feedbackDiv.innerHTML = 'âŒ <strong>Incorrect!</strong> The correct answer is: <strong>The Statistical Analysis Plan (SAP)</strong>. Proceed to the next question.';
                    setTimeout(loadNextQuestion, 3000); 
                }
            },
            {
                text: "Question 2: What safety rule must be followed before entering the MRI room?",
                options: [
                    "Wear shoes",
                    "Remove all metal items", 
                    "Bring your laptop"
                ],
                answerIndex: 1, 
                correctAction: () => {
                    setPatientPosition(STAGE_POSITIONS['stage-3']); 
                    feedbackDiv.className = 'correct';
                    // ä¿®æ­£é» 2: ä½¿ç”¨ <strong> ä»£æ›¿ **
                    feedbackDiv.innerHTML = 'âœ… <strong>Correct!</strong> The patient has safely and fully entered the MRI! Game over.';
                },
                incorrectAction: () => {
                    patientElement.classList.add('shake-animation'); 
                    setPatientPosition(STAGE_POSITIONS['stage-1']); 
                    
                    feedbackDiv.className = 'incorrect';
                    // ä¿®æ­£é» 3: ä½¿ç”¨ <strong> ä»£æ›¿ **
                    feedbackDiv.innerHTML = 'âŒ <strong>Incorrect!</strong> The correct answer is: <strong>Remove all metal items</strong>. Please <strong>re-check for metal items</strong> before trying again!';
                    
                    setTimeout(() => {
                        patientElement.classList.remove('shake-animation');
                        isAnswerLocked = false;
                        loadQuestion(currentQuestionIndex); 
                    }, 3000);
                }
            }
        ];

        function loadQuestion(index) {
            if (index >= questions.length) {
                questionArea.innerHTML = '<h2>Game Over! Thank you for participating.</h2>';
                return;
            }

            const q = questions[index];
            currentQuestionIndex = index;
            isAnswerLocked = false;
            feedbackDiv.className = 'info';
            feedbackDiv.innerHTML = 'Please select an answer.';
            
            if (index === 0) {
                setPatientPosition(STAGE_POSITIONS['stage-1']);
            } else if (index === 1) {
                setPatientPosition(STAGE_POSITIONS['stage-2']); 
            }
            
            let html = `<div class="question-box"><h3>${q.text}</h3>`;
            q.options.forEach((option, i) => {
                html += `<button class="option-button" data-index="${i}">${option}</button>`;
            });
            html += `</div>`;
            
            questionArea.innerHTML = html;

            document.querySelectorAll('.option-button').forEach(button => {
                button.addEventListener('click', () => {
                    if (!isAnswerLocked) {
                        checkAnswer(button.getAttribute('data-index'));
                    }
                });
            });
        }

        function checkAnswer(selectedIndex) {
            if (isAnswerLocked) return;

            isAnswerLocked = true;
            const q = questions[currentQuestionIndex];
            const selected = parseInt(selectedIndex);
            const isCorrect = selected === q.answerIndex;
            const correctOptionText = q.options[q.answerIndex];

            document.querySelectorAll('.option-button').forEach((button, i) => {
                button.classList.add('disabled');
                if (i === q.answerIndex) {
                    button.style.backgroundColor = '#4caf50'; 
                } else if (i === selected && !isCorrect) {
                    button.style.backgroundColor = '#f44336'; 
                }
            });


            if (isCorrect) {
                feedbackDiv.className = 'correct';
                // ä¿®æ­£é» 4: ä½¿ç”¨ <strong> ä»£æ›¿ **
                feedbackDiv.innerHTML = 'âœ… <strong>Correct!</strong> The patient moves to the next stage!';
                q.correctAction();
                
                if (currentQuestionIndex < questions.length - 1) {
                    setTimeout(loadNextQuestion, 2000); 
                }

            } else {
                q.incorrectAction();
            }
        }

        function loadNextQuestion() {
            currentQuestionIndex++;
            document.querySelectorAll('.option-button').forEach(button => {
                button.classList.remove('disabled');
                button.style.backgroundColor = '#00897b'; 
            });
            loadQuestion(currentQuestionIndex);
        }

        // éŠæˆ²é–‹å§‹
        loadQuestion(0);
    </script>

</body>
</html>
